#!/bin/bash

# Replace these values with your desired author information
OLD_EMAIL="bhjsdev@gmail.com"
NEW_NAME="Bhjs Dev"
NEW_EMAIL="bhjsdev@gmail.com"

# First, verify if commits exist with the old email
echo "Checking for commits with email: $OLD_EMAIL"
if ! git log --author="$OLD_EMAIL" --pretty=format:"%h %ae %ce" | grep -q "$OLD_EMAIL"; then
    echo "No commits found with email: $OLD_EMAIL"
    echo "Please verify the old email address is correct"
    exit 1
fi

# Git filter-branch command with explicit HEAD reference
git filter-branch -f --env-filter "
if [ \"\$GIT_COMMITTER_EMAIL\" = \"$OLD_EMAIL\" ]
then
    export GIT_COMMITTER_NAME=\"$NEW_NAME\"
    export GIT_COMMITTER_EMAIL=\"$NEW_EMAIL\"
fi
if [ \"\$GIT_AUTHOR_EMAIL\" = \"$OLD_EMAIL\" ]
then
    export GIT_AUTHOR_NAME=\"$NEW_NAME\"
    export GIT_AUTHOR_EMAIL=\"$NEW_EMAIL\"
fi
" HEAD

# Clean up the old refs
git update-ref -d refs/original/refs/heads/main
